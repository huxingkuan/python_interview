## 1.TCP/IP网络模型

- **应用层**

  最上层的，也是我们能直接接触到的就是应用层，我们电脑或手机使用的应用软件都是在应用层实现。那么，当两个不同设备的应用需要通信的时候，应用九八应用数据传给下一层，也就是传输层。

  所以，应用层只需要专注于为用户提供应用功能，比如HTTP、FTP、Telnet、DNS、SMTP等。

  应用层不需要关心数据是如何传输的，而且应用层是工作在操作系统的用户态，传输层及以下则工作在内核态。

- **传输层**

  应用层的数据包会传给传输层，传输层是为应用层提供网络支持的。

  在传输层分别有两个传输协议，分别是TCP和UDP。

  大部分的应用使用的都是TCP协议，比如HTTP应用层协议。TCP相比UDP多了很多特性，比如流量控制、超时重传、拥塞控制等，这些都是为了数据包能可靠的传输给对方。

  UDP相对来说就简单很多，其只负责发送数据包，不保证是否能抵达对方，但它实时性相对更好，传输效率也高。当然，UDP也可以实现可靠传输，把TCP的特性在应用层上实现即可，不过要实现一个商用的可靠UDP传输协议，也不是一件简单的事情。

  应用需要传输的数据可能会非常大，如果直接传输就不好控制，因此当传输层的数据包大小超过MSS（TCP最大报文段长度），就要将数据包分块，这样即使中途有一个分块丢失或损坏了，只需要重新发送这一个分块，而不用重新发送整个数据包。在TCP协议中，我们把每个分块称为一个TCP段。

  当设备作为接收方时，传输层则要负责把数据包传给应用，但是一台设备上可能会有很多应用在接收或者传输数据，因此需要用一个编号将应用区分开来，这个编号就是端口。

  比如 80 端口通常是 Web 服务器用的，22 端口通常是远程登录服务器用的。而对于浏览器（客户端）中的每个标签栏都是一个独立的进程，操作系统会为这些进程分配临时的端口号。

  由于传输层的报文中会携带端口号，因此接收方可以识别出该报文是发送给哪个应用。

- **网络层**

  传输层把数据包交给网络层，网络层最常使用的是IP协议，IP协议会将传输层的报文作为数据部分，再加上IP包头组装成IP报文，如果IP报文大小超过MTU（以太网中一般为1500字节）就会再次进行分片，得到一个即将发送到网络的IP报文。网络层是通过IP地址寻址发送的目的地，在寻址的过程中，先匹配到相同的网络号即同一个子网，才会去找对应的主机。

  除了寻址能力，IP协议还有另一个重要的能力就是路由。实际场景中，两台设备并不是用一条网线连接起来的，而是通过很多网关、路由器、交换机等众多网络设备连接起来的，那么就会形成很多条网络的路径，因此当数据包到达一个网络节点，就需要通过路由算法决定下一步走哪条路径。

  路由器寻址工作中，就是要找到目标地址的子网，找到后进而把数据包转发给对应的网络内。

  因此，IP协议的寻址作用是告诉我们去往下一个目的地该朝哪个方向走，路由则是根据下一个目的地选择路径。寻址像是在导航，路由则像是在操作方向盘。

- **网络接口层**

  生成了IP头部之后，接下来交给网络接口层在IP头部的前面加上MAC头部，并封装成数据帧发送到网络上。

  IP头部中的接收方IP地址表示网络包的目的地，通过这个地址我们就可以判断要将包发送到哪里，但是在以太网的世界中，这个思路是行不通的。
  
  以太网是一种在局域网内，把附近的设备连接起来，使它们之间可以进行通讯的技术。
  
  以太网在判断网络包目的地时和IP寻址的方式不同，因此必须采用相匹配的方式才能在以太网中将包发往目的地，而MAC头部就是起这个作用的，所以，在以太网中进行通讯要用到MAC地址。
  
  MAC头部是以太网使用的头部，它包含了接收方和发送方的MAC地址等信息，可以通过ARP协议获取对方MAC地址。
  
  所以说，网络接口层主要为网络层提供链路级别传输的服务，负责在以太网、WIFI这样的底层网络上发送原始数据包，工作在网卡这个层次，使用MAC地址来标识网络上的设备。

## 2.讲讲OSI协议

> 横向看（为哪两个平行的东西提供服务）
>
> 纵向看（为上层提供什么服务）
>
> 协议举例

- 应用层：
  - 为应用程序间提供通信和交互的协议。
  - DNS、HTTP、SMTP等。
- 传输层
  - 为两台主机中的进程间提供通用的数据传输服务。
  - 为上层提供服务：把应用层的报文封装成TCP的报文段或UDP的用户数据报进行传送。
  - TCP、UDP
- 网络层
  - 为两台主机提供通信服务。
  - 为上层提供服务：把运输层产生的报文段或用户数据报封装成IP数据报进行传送。
  - ARP、ICMP
- 数据链路层
  - 还是为两台主机之间的数据传输提供服务，两台主机之间的传输，总是在一段一段的链路上传送的，就需要链路层的协议。
  - 为上层提供服务：把IP数据报封装成帧，在链路上进行传递。
  - CSMA PPP
- 物理层
  - 在传输媒体上进行比特流的传输。
  - 为上层提供服务：尽可能为数据链路层屏蔽传输媒体和通信手段的差异，把帧拆分成比特流在传输媒介上进行传输。
  - 时分复用、频分复用、码分多址、波分复用等。

## 3.应用层

### 3.1DNS协议

是域名解析协议，提供了域名和IP地址之间相互转换的服务。

可以使用UDP或TCP，但一般用UDP，因为块，只要一个请求，一个应答就OK了

但UDP协议传输的内容不能超过512字节，一般客户端向DNS服务器查域名，返回的内容都不超过512字节，用UDP就够了。

**为什么区域传送用TCP呢？**

什么是区域传送，就是主DNS服务器上的数据有变化了，需要向下传送变化的那部分数据时，因为数据必然很大，并且要保证传输可靠，所以不能用UDP。

因为DNS时分布式数据库，要从主DNS上赋值内容时，不能用不可靠的UDP，需要用TCP协议。

### 3.2DHCP协议

知道是干什么的就行了：

给用户提供即插即用的联网方式，用户不需要再手动配置IP地址等信息。

其自动为用户配置IP地址、子网掩码、网关等信息。

### 3.3应用层还有没有别的协议？

FTP、动态主机配置协议、SMTP电子邮件协议

### 3.4Web页面的请求过程

应用层：URL敲下之后，首先浏览器会生成一个TCP套接字，以向目标HTTP服务器请求资源。为了生成套接字，需要知道该URL域名对应的IP地址。

